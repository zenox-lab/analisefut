<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Ligas</title>
    <!-- Carrega o Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carrega a biblioteca de Ícones (Lucide) -->
    <script src="https://unpkg.com/lucide-dev@latest/dist/lucide.js"></script>
    
    <style>
        /* Tema Claro */
        :root {
            --bg-color: #f4f7f6; /* Fundo principal (branco-acinzentado) */
            --card-bg-color: #ffffff; /* Fundo dos cards (branco puro) */
            --text-color-primary: #1a202c; /* Texto principal (quase preto) */
            --text-color-secondary: #5a6a85; /* Texto secundário (cinza-azulado) */
            --border-color: #e2e8f0; /* Bordas (cinza claro) */
            --accent-color: #3b82f6; /* Cor de destaque (azul) */
            --accent-color-hover: #2563eb; /* Destaque hover */
            --danger-color: #ef4444; /* Vermelho para excluir */
            --danger-color-hover: #dc2626; /* Vermelho hover */
        }

        body {
            font-family: 'Inter', sans-serif; /* Fonte mais moderna */
            background-color: var(--bg-color);
            color: var(--text-color-primary);
            transition: background-color 0.3s;
        }

        /* --- Layout Principal --- */
        .main-container {
            max-width: 7xl; /* Layout mais largo */
            margin-left: auto;
            margin-right: auto;
            padding: 1.5rem; /* 24px */
        }
        
        .header-title {
            font-size: 2.25rem; /* 36px */
            font-weight: 800; /* Extra-bold */
            color: var(--text-color-primary);
            text-align: center;
            margin-bottom: 0.5rem; /* 8px */
        }
        
        .header-subtitle {
            font-size: 1.125rem; /* 18px */
            color: var(--text-color-secondary);
            text-align: center;
            margin-bottom: 2.5rem; /* 40px */
        }

        /* --- Cards de Seleção de Liga --- */
        .league-card {
            display: block;
            background-color: var(--card-bg-color);
            border-radius: 0.75rem; /* 12px */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.07), 0 2px 4px -2px rgba(0, 0, 0, 0.07);
            padding: 1.5rem; /* 24px */
            text-align: center;
            transition: all 0.2s ease-in-out;
            border: 1px solid var(--border-color);
            cursor: pointer;
        }
        .league-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -4px rgba(0, 0, 0, 0.08);
        }
        .logo-container {
            height: 6rem; /* 96px */
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 1.25rem; /* 20px */
        }
        .league-logo {
            height: 5rem; /* 80px */
            width: auto;
            object-fit: contain;
        }
        .league-title {
            font-size: 1.25rem; /* 20px */
            font-weight: 600; /* Semibold */
            color: var(--text-color-primary);
        }

        /* --- Botões --- */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.625rem 1.25rem; /* 10px 20px */
            border-radius: 0.5rem; /* 8px */
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            border: 1px solid transparent;
        }
        .btn-primary {
            background-color: var(--accent-color);
            color: #ffffff;
            border-color: var(--accent-color);
        }
        .btn-primary:hover {
            background-color: var(--accent-color-hover);
            border-color: var(--accent-color-hover);
        }
        .btn-secondary {
            background-color: var(--card-bg-color);
            color: var(--text-color-primary);
            border-color: var(--border-color);
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .btn-secondary:hover {
            background-color: #f9fafb; /* Cinza leve hover */
        }
        .btn-danger {
            background-color: var(--danger-color);
            color: #ffffff;
        }
        .btn-danger:hover {
            background-color: var(--danger-color-hover);
        }
        .btn-sm {
            padding: 0.375rem 0.75rem; /* 6px 12px */
            font-size: 0.875rem; /* 14px */
        }

        /* --- Formulários --- */
        .form-input, .form-select, .form-date {
            width: 100%;
            background-color: #ffffff;
            color: var(--text-color-primary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem; /* 8px */
            padding: 0.75rem 1rem; /* 12px 16px */
            font-size: 1rem; /* 16px */
            transition: border-color 0.2s, box-shadow 0.2s;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .form-input:focus, .form-select:focus, .form-date:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); /* Sombra de foco azul */
        }
        .form-label {
            display: block;
            font-size: 0.875rem; /* 14px */
            font-weight: 500;
            color: var(--text-color-secondary);
            margin-bottom: 0.5rem; /* 8px */
        }
        .form-group {
            margin-bottom: 1.25rem; /* 20px */
        }

        /* --- Card Genérico (para formulário, tabelas, etc.) --- */
        .content-card {
            background-color: var(--card-bg-color);
            border-radius: 0.75rem; /* 12px */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.07), 0 2px 4px -2px rgba(0, 0, 0, 0.07);
            border: 1px solid var(--border-color);
            overflow: hidden; /* Para conter bordas da tabela */
        }
        .content-card-header {
            padding: 1.25rem 1.5rem; /* 20px 24px */
            border-bottom: 1px solid var(--border-color);
        }
        .content-card-title {
            font-size: 1.25rem; /* 20px */
            font-weight: 600;
            color: var(--text-color-primary);
        }
        .content-card-body {
            padding: 1.5rem; /* 24px */
        }
        
        /* --- Lista de Jogos Salvos (Estilo Card) --- */
        .game-card {
            display: flex;
            flex-direction: column;
            gap: 1rem; /* 16px */
            padding: 1.25rem; /* 20px */
            border: 1px solid var(--border-color);
            border-radius: 0.75rem; /* 12px */
            margin-bottom: 1rem; /* 16px */
            background-color: #f9fafb; /* Fundo levemente acinzentado */
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05);
        }
        .game-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; /* Para telas pequenas */
        }
        .game-date {
            font-size: 0.875rem; /* 14px */
            font-weight: 500;
            color: var(--text-color-secondary);
        }
        .game-teams {
            font-size: 1.125rem; /* 18px */
            font-weight: 600;
            text-align: center;
            flex-grow: 1; /* Faz os times ocuparem o espaço */
        }
        .game-score-details {
            display: flex;
            justify-content: center;
            gap: 1.5rem; /* 24px */
            text-align: center;
        }
        .score-block {
            font-size: 0.875rem; /* 14px */
            color: var(--text-color-secondary);
        }
        .score-block span {
            display: block;
            font-size: 1.25rem; /* 20px */
            font-weight: 600;
            color: var(--text-color-primary);
        }
        
        /* --- Quadrados de Análise por Time --- */
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 1rem; /* 16px */
        }
        .team-stats-card {
            background-color: #f9fafb; /* Fundo levemente acinzentado */
            border-radius: 0.75rem; /* 12px */
            border: 1px solid var(--border-color);
            padding: 1rem; /* 16px */
        }
        .team-stats-header {
            font-size: 1.125rem; /* 18px */
            font-weight: 600;
            color: var(--text-color-primary);
            margin-bottom: 1rem; /* 16px */
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.75rem; /* 12px */
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem; /* 16px */
        }
        .stat-item {
            text-align: center;
        }
        .stat-label {
            font-size: 0.75rem; /* 12px */
            font-weight: 500;
            color: var(--text-color-secondary);
            text-transform: uppercase;
            margin-bottom: 0.25rem; /* 4px */
        }
        .stat-value {
            font-size: 1.25rem; /* 20px */
            font-weight: 700;
            color: var(--text-color-primary);
        }
        .stat-value-pro { color: #22c55e; } /* Verde */
        .stat-value-con { color: #ef4444; } /* Vermelho */
        .stat-total-games {
            font-size: 0.875rem; /* 14px */
            color: var(--text-color-secondary);
            margin-top: 1rem; /* 16px */
            text-align: center;
            font-style: italic;
        }

        /* --- Utilities --- */
        .hidden {
            display: none;
        }
        .icon {
            width: 1.125rem; /* 18px */
            height: 1.125rem; /* 18px */
            stroke-width: 2.5;
            margin-right: 0.5rem; /* 8px */
            vertical-align: text-bottom;
        }
        .grid-3-col {
            display: grid;
            grid-template-columns: repeat(1, minmax(0, 1fr));
            gap: 1.5rem; /* 24px */
        }
        @media (min-width: 640px) { /* sm */
            .grid-3-col {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }
        @media (min-width: 1024px) { /* lg */
            .grid-3-col {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
        }
        
        /* --- Layout 2 Colunas (Tela da Liga) --- */
        .league-layout-grid {
            display: grid;
            grid-template-columns: repeat(1, minmax(0, 1fr));
            gap: 1.5rem; /* 24px */
        }
        @media (min-width: 1024px) { /* lg */
            .league-layout-grid {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
            .league-col-main {
                grid-column: span 2 / span 2;
            }
            .league-col-aside {
                grid-column: span 1 / span 1;
            }
        }
        .league-col-main {
            display: flex;
            flex-direction: column;
            gap: 1.5rem; /* 24px */
        }
        .league-col-aside-sticky {
            position: sticky;
            top: 2rem; /* 32px */
        }
        
    </style>
</head>
<body>
    
    <div class="main-container">
        
        <!-- === TELA 1: SELEÇÃO DE LIGA === -->
        <section id="league-selection-view">
            <header>
                <h1 class="header-title">Dashboard de Ligas</h1>
                <p class="header-subtitle">Selecione uma liga para ver ou registrar estatísticas.</p>
            </header>
            
            <div class="grid-3-col">
                <!-- Premier League -->
                <div class="league-card" data-league="Premier League">
                    <div class="logo-container">
                        <img src="https://upload.wikimedia.org/wikipedia/en/f/f2/Premier_League_logo.svg" alt="Logo Premier League" class="league-logo">
                    </div>
                    <h3 class="league-title">Premier League</h3>
                </div>
                <!-- LaLiga -->
                <div class="league-card" data-league="LaLiga">
                    <div class="logo-container">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/1/13/LaLiga_EA_Sports_2023_Vertical_Logo.svg" alt="Logo LaLiga" class="league-logo">
                    </div>
                    <h3 class="league-title">LaLiga</h3>
                </div>
                <!-- Bundesliga -->
                <div class="league-card" data-league="Bundesliga">
                    <div class="logo-container">
                        <img src="https://upload.wikimedia.org/wikipedia/en/d/df/Bundesliga_logo_%282017%29.svg" alt="Logo Bundesliga" class="league-logo">
                    </div>
                    <h3 class="league-title">Bundesliga</h3>
                </div>
                <!-- Serie A -->
                <div class="league-card" data-league="Serie A">
                    <div class="logo-container">
                        <img src="https://upload.wikimedia.org/wikipedia/en/e/e1/Serie_A_logo_%282019%29.svg" alt="Logo Serie A" class="league-logo">
                    </div>
                    <h3 class="league-title">Serie A</h3>
                </div>
                <!-- Ligue 1 -->
                <div class="league-card" data-league="Ligue 1">
                    <div class="logo-container">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/c/ca/Ligue1_Uber_Eats_Logo.svg" alt="Logo Ligue 1" class="league-logo" style="background-color: #ffffff; padding: 8px; border-radius: 8px;">
                    </div>
                    <h3 class="league-title">Ligue 1</h3>
                </div>
                <!-- Liga Portugal -->
                <div class="league-card" data-league="Liga Portugal">
                    <div class="logo-container">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/4/4b/Liga_Portugal_Betclic_logo.svg" alt="Logo Liga Portugal" class="league-logo" style="background-color: #ffffff; padding: 8px; border-radius: 8px;">
                    </div>
                    <h3 class="league-title">Liga Portugal</h3>
                </div>
            </div>
        </section>

        <!-- === TELA 2: VISÃO DA LIGA (Layout de 2 Colunas) === -->
        <section id="league-view" class="hidden">
            
            <!-- Cabeçalho da Liga com Botão Voltar -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <button id="back-to-leagues-btn" class="btn btn-secondary">
                    <i data-lucide="arrow-left" class="icon"></i>
                    Voltar
                </button>
                <h1 id="league-view-title" class="header-title" style="margin-bottom: 0;"></h1>
                <div style="width: 80px;"></div> <!-- Espaçador para centralizar o título -->
            </div>

            <!-- Grid de Layout (Principal + Lateral) -->
            <div class="league-layout-grid">
                
                <!-- Coluna Principal (Formulário e Jogos Salvos) -->
                <div class="league-col-main">
                    <!-- Formulário de Registro -->
                    <div class="content-card">
                        <div class="content-card-header">
                            <h2 class="content-card-title">Registrar Novo Jogo</h2>
                        </div>
                        <form id="game-form" class="content-card-body">
                            <div class="form-group">
                                <label for="game-date" class="form-label">Data do Jogo</label>
                                <input type="date" id="game-date" class="form-date" required>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(1, 1fr); gap: 1rem; @media (min-width: 640px) { grid-template-columns: repeat(2, 1fr); }">
                                <div class="form-group">
                                    <label for="home-team-select" class="form-label">Time da Casa</label>
                                    <select id="home-team-select" class="form-select" required></select>
                                </div>
                                <div class="form-group">
                                    <label for="away-team-select" class="form-label">Time Visitante</label>
                                    <select id="away-team-select" class="form-select" required></select>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                                <div class="form-group">
                                    <label for="home-goals" class="form-label">Gols Casa</label>
                                    <input type="number" id="home-goals" class="form-input" min="0" value="0" required>
                                </div>
                                <div class="form-group">
                                    <label for="away-goals" class="form-label">Gols Visitante</label>
                                    <input type="number" id="away-goals" class="form-input" min="0" value="0" required>
                                </div>
                                <div class="form-group">
                                    <label for="home-corners" class="form-label">Escanteios Casa</label>
                                    <input type="number" id="home-corners" class="form-input" min="0" value="0" required>
                                </div>
                                <div class="form-group">
                                    <label for="away-corners" class="form-label">Escanteios Visitante</label>
                                    <input type="number" id="away-corners" class="form-input" min="0" value="0" required>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary" style="width: 100%;">
                                <i data-lucide="save" class="icon"></i>
                                Salvar Jogo
                            </button>
                        </form>
                    </div>

                    <!-- Jogos Salvos -->
                    <div class="content-card">
                        <div class="content-card-header">
                            <h2 class="content-card-title">Jogos Salvos</h2>
                        </div>
                        <div class="content-card-body">
                            <div id="game-list-container">
                                <!-- Os cards de jogo serão inseridos aqui -->
                            </div>
                            <p id="no-games-message" class="text-center text-gray-500 hidden">Nenhum jogo salvo para esta liga.</p>
                        </div>
                    </div>
                </div> <!-- Fim Coluna Principal -->
                
                <!-- Coluna Lateral (Análise por Time) -->
                <div class="league-col-aside">
                    <div class="league-col-aside-sticky">
                        <div class="content-card">
                            <div class="content-card-header">
                                <h2 class="content-card-title">Análise por Time</h2>
                            </div>
                            <div class="content-card-body">
                                <p class="text-sm text-gray-500 mb-4">Média dos últimos 10 jogos registrados.</p>
                                <div id="team-analysis-container" class="analysis-grid">
                                    <!-- Os cards de estatística de time serão inseridos aqui -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- Fim Coluna Lateral -->
                
            </div> <!-- Fim Grid de Layout -->
            
        </section>
        
    </div> <!-- fim .main-container -->

    <script>
        // --- Inicialização do Lucide (Ícones) ---
        // Atrasamos a chamada inicial para garantir que a biblioteca carregou
        setTimeout(() => {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }, 100);

        // --- Dados das Ligas e Times (Temporada 2024/2025) ---
        const leagueTeams = {
            "Premier League": ["Arsenal", "Aston Villa", "Bournemouth", "Brentford", "Brighton", "Chelsea", "Crystal Palace", "Everton", "Fulham", "Ipswich Town", "Leicester City", "Liverpool", "Man City", "Man Utd", "Newcastle", "Nottingham Forest", "Southampton", "Tottenham", "West Ham", "Wolves"],
            "LaLiga": ["Alavés", "Athletic Bilbao", "Atlético Madrid", "Barcelona", "Celta Vigo", "Espanyol", "Getafe", "Girona", "Las Palmas", "Leganés", "Mallorca", "Osasuna", "Rayo Vallecano", "Real Betis", "Real Madrid", "Real Sociedad", "Sevilla", "Valencia", "Valladolid", "Villarreal"],
            "Bundesliga": ["Augsburg", "Bayer Leverkusen", "Bayern Munich", "Bochum", "Borussia Dortmund", "Borussia M'gladbach", "Eintracht Frankfurt", "Freiburg", "Heidenheim", "Holstein Kiel", "Hoffenheim", "Mainz", "RB Leipzig", "St. Pauli", "Stuttgart", "Union Berlin", "Werder Bremen", "Wolfsburg"],
            "Serie A": ["Atalanta", "Bologna", "Cagliari", "Como", "Empoli", "Fiorentina", "Genoa", "Hellas Verona", "Inter Milan", "Juventus", "Lazio", "Lecce", "AC Milan", "Monza", "Napoli", "Parma", "Roma", "Torino", "Udinese", "Venezia"],
            "Ligue 1": ["Angers", "Auxerre", "Brest", "Le Havre", "Lens", "Lille", "Lyon", "Marseille", "Monaco", "Montpellier", "Nantes", "Nice", "PSG", "Reims", "Rennes", "Saint-Étienne", "Strasbourg", "Toulouse"],
            "Liga Portugal": ["Arouca", "AVS", "Benfica", "Boavista", "Braga", "Casa Pia", "Estrela Amadora", "Famalicon", "Farense", "Gil Vicente", "Moreirense", "Nacional", "Porto", "Rio Ave", "Santa Clara", "Sporting CP", "Vitória de Guimarães", "Vizela"]
        };

        // --- Banco de Dados (localStorage) ---
        const localStorageKey = 'meusJogosDB_v3'; // Chave atualizada
        let allGames = [];
        let currentLeague = null;

        // --- Elementos DOM ---
        const views = {
            leagueSelection: document.getElementById('league-selection-view'),
            leagueView: document.getElementById('league-view')
        };
        const leagueCards = document.querySelectorAll('.league-card');
        const backToLeaguesBtn = document.getElementById('back-to-leagues-btn');
        const leagueViewTitle = document.getElementById('league-view-title');
        
        // Formulário
        const gameForm = document.getElementById('game-form');
        const gameDateInput = document.getElementById('game-date');
        const homeTeamSelect = document.getElementById('home-team-select');
        const awayTeamSelect = document.getElementById('away-team-select');
        const homeGoalsInput = document.getElementById('home-goals');
        const awayGoalsInput = document.getElementById('away-goals');
        const homeCornersInput = document.getElementById('home-corners');
        const awayCornersInput = document.getElementById('away-corners');
        
        // Exibição de Dados
        const gameListContainer = document.getElementById('game-list-container');
        const noGamesMessage = document.getElementById('no-games-message');
        const teamAnalysisContainer = document.getElementById('team-analysis-container');
        
        // --- Funções Principais ---

        /**
         * Carrega todos os jogos do localStorage
         */
        function loadAllGames() {
            const gamesJson = localStorage.getItem(localStorageKey);
            allGames = gamesJson ? JSON.parse(gamesJson) : [];
        }

        /**
         * Salva todos os jogos no localStorage
         */
        function saveAllGames() {
            localStorage.setItem(localStorageKey, JSON.stringify(allGames));
        }

        /**
         * Troca a tela visível
         */
        function showView(viewId) {
            Object.values(views).forEach(view => view.classList.add('hidden'));
            if (views[viewId]) {
                views[viewId].classList.remove('hidden');
            }
            // Atualiza os ícones na nova tela
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        /**
         * Abre a tela de uma liga específica
         */
        function openLeagueView(leagueName) {
            currentLeague = leagueName;
            leagueViewTitle.textContent = leagueName;
            
            // 1. Popula os selects do formulário
            const teams = leagueTeams[leagueName].sort();
            homeTeamSelect.innerHTML = '';
            awayTeamSelect.innerHTML = '';
            teams.forEach(team => {
                homeTeamSelect.innerHTML += `<option value="${team}">${team}</option>`;
                awayTeamSelect.innerHTML += `<option value="${team}">${team}</option>`;
            });

            // 2. Define a data de hoje no formulário
            gameDateInput.value = new Date().toISOString().split('T')[0];

            // 3. Renderiza todos os dados da liga (jogos e análise)
            renderLeagueData();
            
            // 4. Mostra a tela da liga
            showView('leagueView');
        }

        /**
         * Renderiza todos os dados da liga atual (jogos e análise)
         */
        function renderLeagueData() {
            renderSavedGames();
            renderTeamAnalysis();
        }

        /**
         * Renderiza os jogos salvos da liga atual
         */
        function renderSavedGames() {
            const leagueGames = allGames
                .filter(game => game.league === currentLeague)
                .sort((a, b) => new Date(b.date) - new Date(a.date)); // Mais recentes primeiro

            gameListContainer.innerHTML = ''; // Limpa a lista
            
            if (leagueGames.length === 0) {
                noGamesMessage.classList.remove('hidden');
            } else {
                noGamesMessage.classList.add('hidden');
                leagueGames.forEach(game => {
                    const gameCard = createGameCard(game);
                    gameListContainer.innerHTML += gameCard;
                });
            }

            // Adiciona listeners aos botões de excluir
            document.querySelectorAll('.delete-game-btn').forEach(btn => {
                btn.addEventListener('click', handleDeleteGame);
            });
        }
        
        /**
         * Renderiza os "quadrados" de Análise por Time
         */
        function renderTeamAnalysis() {
            const teams = leagueTeams[currentLeague].sort();
            teamAnalysisContainer.innerHTML = ''; // Limpa a análise
            
            teams.forEach(team => {
                // Pega todos os jogos do time (casa ou fora)
                const teamGames = allGames
                    .filter(game => game.league === currentLeague && (game.homeTeam === team || game.awayTeam === team))
                    .sort((a, b) => new Date(b.date) - new Date(a.date)) // Ordena por data
                    .slice(0, 10); // Pega apenas os últimos 10
                    
                const stats = {
                    games: teamGames.length,
                    goalsPro: 0,
                    goalsCon: 0,
                    cornersPro: 0,
                    cornersCon: 0
                };

                teamGames.forEach(game => {
                    if (game.homeTeam === team) {
                        stats.goalsPro += game.homeGoals;
                        stats.goalsCon += game.awayGoals;
                        stats.cornersPro += game.homeCorners;
                        stats.cornersCon += game.awayCorners;
                    } else { // awayTeam === team
                        stats.goalsPro += game.awayGoals;
                        stats.goalsCon += game.homeGoals;
                        stats.cornersPro += game.awayCorners;
                        stats.cornersCon += game.homeCorners;
                    }
                });

                // Calcula médias
                const avgGoalsPro = (stats.games > 0 ? (stats.goalsPro / stats.games) : 0).toFixed(1);
                const avgGoalsCon = (stats.games > 0 ? (stats.goalsCon / stats.games) : 0).toFixed(1);
                const avgCornersPro = (stats.games > 0 ? (stats.cornersPro / stats.games) : 0).toFixed(1);
                const avgCornersCon = (stats.games > 0 ? (stats.cornersCon / stats.games) : 0).toFixed(1);

                const analysisCard = `
                    <div class="team-stats-card">
                        <h3 class="team-stats-header">${team}</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-label">Média Gols Pró</div>
                                <div class="stat-value stat-value-pro">${avgGoalsPro}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Média Gols Contra</div>
                                <div class="stat-value stat-value-con">${avgGoalsCon}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Média Escan. Pró</div>
                                <div class="stat-value stat-value-pro">${avgCornersPro}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Média Escan. Contra</div>
                                <div class="stat-value stat-value-con">${avgCornersCon}</div>
                            </div>
                        </div>
                        <p class="stat-total-games">Baseado nos últimos ${stats.games} jogos</p>
                    </div>
                `;
                teamAnalysisContainer.innerHTML += analysisCard;
            });
            
            // Atualiza ícones do Lucide (caso haja algum nos cards de análise, o que não há agora)
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }


        /**
         * Cria o HTML para um card de jogo salvo
         */
        function createGameCard(game) {
            const homeScoreClass = game.homeGoals > game.awayGoals ? 'font-bold' : '';
            const awayScoreClass = game.awayGoals > game.homeGoals ? 'font-bold' : '';

            return `
                <div class="game-card">
                    <div class="game-card-header">
                        <span class="game-date">${new Date(game.date).toLocaleDateString('pt-BR', {day: '2-digit', month: '2-digit', year: 'numeric'})}</span>
                        <button class="btn btn-danger btn-sm delete-game-btn" data-game-id="${game.id}">
                            <i data-lucide="trash-2" style="width: 14px; height: 14px;"></i>
                        </button>
                    </div>
                    <div class="game-teams">
                        ${game.homeTeam} <span class="text-gray-400">vs</span> ${game.awayTeam}
                    </div>
                    <div class="game-score-details">
                        <div class="score-block">
                            Gols
                            <span>
                                <span class="${homeScoreClass}">${game.homeGoals}</span> x <span class="${awayScoreClass}">${game.awayGoals}</span>
                            </span>
                        </div>
                        <div class="score-block">
                            Escanteios
                            <span>${game.homeCorners} x ${game.awayCorners}</span>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // --- Handlers de Eventos ---

        /**
         * Salva um novo jogo
         */
        function handleSaveGame(event) {
            event.preventDefault(); // Impede o envio real do formulário
            
            // Validação simples
            if (homeTeamSelect.value === awayTeamSelect.value) {
                alert("O time da casa não pode ser igual ao time visitante.");
                return;
            }

            const newGame = {
                id: Date.now().toString(),
                date: gameDateInput.value,
                league: currentLeague,
                homeTeam: homeTeamSelect.value,
                awayTeam: awayTeamSelect.value,
                homeGoals: parseInt(homeGoalsInput.value, 10),
                awayGoals: parseInt(awayGoalsInput.value, 10),
                homeCorners: parseInt(homeCornersInput.value, 10),
                awayCorners: parseInt(awayCornersInput.value, 10)
            };
            
            // Adiciona o novo jogo
            allGames.push(newGame);
            
            // Salva no localStorage
            saveAllGames();
            
            // Reseta o formulário
            gameForm.reset();
            gameDateInput.value = new Date().toISOString().split('T')[0]; // Reseta data p/ hoje
            
            // Re-renderiza tudo (lista de jogos e análise)
            renderLeagueData();
        }

        /**
         * Exclui um jogo
         */
        function handleDeleteGame(event) {
            const gameId = event.currentTarget.dataset.gameId;
            // Confirmação simples (pode ser substituída por um modal)
            if (confirm('Tem certeza que deseja excluir este jogo?')) {
                allGames = allGames.filter(game => game.id !== gameId);
                saveAllGames();
                // Re-renderiza tudo (lista de jogos e análise)
                renderLeagueData();
            }
        }

        // --- Inicialização ---
        document.addEventListener('DOMContentLoaded', () => {
            // Carrega os jogos salvos
            loadAllGames();

            // Adiciona listeners aos cards das ligas
            leagueCards.forEach(card => {
                card.addEventListener('click', () => {
                    const leagueName = card.dataset.league;
                    openLeagueView(leagueName);
                });
            });

            // Listener do botão de Voltar
            backToLeaguesBtn.addEventListener('click', () => {
                showView('leagueSelection');
            });

            // Listener do formulário
            gameForm.addEventListener('submit', handleSaveGame);
            
            // Mostra a tela inicial
            showView('leagueSelection');
        });
    </script>
</body>
</html>
