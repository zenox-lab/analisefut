<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Ligas</title>
    <!-- Carrega o Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carrega a biblioteca de Ícones (Lucide) -->
    <script src="https://unpkg.com/lucide-dev@latest/dist/lucide.js"></script>
    
    <style>
        /* Define a fonte Inter como padrão */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* --- Estilo do Layout Principal --- */
        .main-layout {
            display: grid;
            grid-template-columns: 240px 1fr; /* Menu lateral e área de conteúdo */
            min-height: 100vh;
        }

        /* --- Estilo do Menu Lateral (Sidebar) --- */
        .sidebar {
            @apply bg-white shadow-md flex flex-col;
            border-right: 1px solid #e5e7eb; /* Borda direita cinza */
        }
        .sidebar-header {
            @apply p-4 border-b border-gray-200 flex items-center gap-3;
        }
        .sidebar-logo {
            @apply h-8 w-auto text-blue-600;
        }
        .sidebar-title {
            @apply text-xl font-bold text-gray-800;
        }
        .sidebar-nav {
            @apply flex-1 p-3 space-y-1;
        }
        .sidebar-link, .sidebar-welcome-link {
            @apply flex items-center gap-3 p-3 rounded-lg text-gray-700 font-medium transition-colors duration-200;
        }
        .sidebar-link:hover, .sidebar-welcome-link:hover {
            @apply bg-blue-50 text-blue-600;
        }
        .sidebar-link.active {
            @apply bg-blue-600 text-white shadow-md;
        }
        .sidebar-link .league-logo {
            @apply h-6 w-6 object-contain;
        }
        .sidebar-link .icon-placeholder {
            @apply h-6 w-6;
        }

        /* --- Área de Conteúdo Principal --- */
        .main-content {
            @apply bg-gray-50 p-6 md:p-10 overflow-auto;
        }

        /* --- Telas (Views) --- */
        .view {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Estilo dos Componentes (Tema Claro) --- */
        
        /* Cabeçalho da Seção */
        .section-header {
            @apply text-3xl font-bold text-gray-900 mb-2;
        }
        .section-subheader {
            @apply text-lg text-gray-500 mb-6;
        }
        
        /* Cards (para Formulário, Análise, etc.) */
        .card {
            @apply bg-white shadow-lg rounded-xl border border-gray-200;
        }
        .card-header {
            @apply p-5 border-b border-gray-200 flex items-center gap-3;
        }
        .card-title {
            @apply text-lg font-semibold text-gray-900;
        }
        .card-content {
            @apply p-6;
        }

        /* Formulários */
        .form-label {
            @apply block text-sm font-medium text-gray-700 mb-1;
        }
        .form-input, .form-select {
            @apply w-full bg-white border border-gray-300 text-gray-900 rounded-lg p-3 shadow-sm;
            @apply focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent;
        }
        .form-input:disabled, .form-select:disabled {
            @apply bg-gray-100 cursor-not-allowed;
        }

        /* Botões */
        .btn {
            @apply font-bold py-3 px-5 rounded-lg transition-colors duration-300 shadow-md;
        }
        .btn-primary {
            @apply bg-blue-600 hover:bg-blue-700 text-white;
        }
        .btn-secondary {
            @apply bg-gray-200 hover:bg-gray-300 text-gray-800;
        }
        .btn-danger {
            @apply bg-red-600 hover:bg-red-700 text-white;
        }

        /* --- Estilos Específicos do App --- */

        /* Lista de Jogos Salvos (Estilo "Resultados") */
        .game-list {
            @apply space-y-3;
        }
        .game-card {
            @apply flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200;
        }
        .game-date {
            @apply text-xs font-semibold text-gray-500 w-20;
        }
        .game-teams {
            @apply flex-1 text-center;
        }
        .team-name {
            @apply text-sm font-semibold text-gray-900;
        }
        .team-name.home {
            @apply text-right;
        }
        .team-name.away {
            @apply text-left;
        }
        .score-line {
            @apply flex justify-center items-center gap-3;
        }
        .score-box {
            @apply text-lg font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-md;
        }
        .score-stats {
            @apply text-xs text-gray-500 font-medium;
        }
        .game-delete {
            @apply w-10 text-center;
        }
        .delete-btn {
            @apply text-gray-400 hover:text-red-500 transition-colors duration-200;
        }

        /* Cards de "Análise por Time" */
        .analysis-grid {
            @apply grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5;
        }
        .team-analysis-card {
            @apply bg-white shadow-md rounded-lg p-5 border border-gray-200;
        }
        .team-card-header {
            @apply flex justify-between items-center mb-4;
        }
        .team-card-title {
            @apply text-lg font-bold text-gray-900 cursor-pointer hover:text-blue-600;
        }
        .team-card-stats {
            @apply space-y-2;
        }
        .stat-line {
            @apply flex justify-between items-center text-sm;
        }
        .stat-label {
            @apply text-gray-600;
        }
        .stat-value {
            @apply font-bold text-gray-900;
        }
        .stat-value.pro {
            @apply text-green-600;
        }
        .stat-value.con {
            @apply text-red-600;
        }

        /* Tabela de Histórico Global */
        .history-table {
            @apply w-full min-w-full text-left text-sm text-gray-800;
        }
        .history-table th {
            @apply bg-gray-100 p-3 font-semibold uppercase tracking-wider;
        }
        .history-table td {
            @apply p-3 border-b border-gray-200;
        }
        .history-table tr:last-child td {
            @apply border-b-0;
        }

        /* Classe helper para esconder/mostrar seções */
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="main-layout">
        
        <!-- --- Menu Lateral Fixo --- -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <i data-lucide="bar-chart-3" class="sidebar-logo"></i>
                <h1 class="sidebar-title">Meu Dashboard</h1>
            </div>
            
            <nav class="sidebar-nav">
                <!-- Link de Boas-Vindas -->
                <a href="#" id="welcome-link" class="sidebar-welcome-link active">
                    <i data-lucide="layout-dashboard" class="icon-placeholder"></i>
                    <span>Visão Geral</span>
                </a>
                
                <!-- Novo Link: Análise de Time -->
                <a href="#" id="analysis-link" class="sidebar-welcome-link">
                    <i data-lucide="search" class="icon-placeholder"></i>
                    <span>Análise de Time</span>
                </a>

                <hr class="my-3 border-gray-200">
                
                <!-- Links das Ligas -->
                <a href="#" class="sidebar-link" data-league="Premier League">
                    <img src="https://upload.wikimedia.org/wikipedia/en/f/f2/Premier_League_logo.svg" alt="Logo Premier League" class="league-logo">
                    <span>Premier League</span>
                </a>
                <a href="#" class="sidebar-link" data-league="LaLiga">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/1/13/LaLiga_EA_Sports_2023_Vertical_Logo.svg" alt="Logo LaLiga" class="league-logo">
                    <span>LaLiga</span>
                </a>
                <a href="#" class="sidebar-link" data-league="Bundesliga">
                    <img src="https://upload.wikimedia.org/wikipedia/en/d/df/Bundesliga_logo_%282017%29.svg" alt="Logo Bundesliga" class="league-logo">
                    <span>Bundesliga</span>
                </a>
                <a href="#" class="sidebar-link" data-league="Serie A">
                    <img src="https://upload.wikimedia.org/wikipedia/en/e/e1/Serie_A_logo_%282019%29.svg" alt="Logo Serie A" class="league-logo">
                    <span>Serie A</span>
                </a>
                <a href="#" class="sidebar-link" data-league="Ligue 1">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/c/ca/Ligue1_Uber_Eats_Logo.svg" alt="Logo Ligue 1" class="league-logo" style="background: white; padding: 2px; border-radius: 4px;">
                <span>Ligue 1</span>
                </a>
                <a href="#" class="sidebar-link" data-league="Liga Portugal">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/4/4b/Liga_Portugal_Betclic_logo.svg" alt="Logo Liga Portugal" class="league-logo" style="background: white; padding: 2px; border-radius: 4px;">
                    <span>Liga Portugal</span>
                </a>
            </nav>
        </aside>

        <!-- --- Área de Conteúdo Principal --- -->
        <main id="main-content-area" class="main-content">
            
            <!-- 1. Tela de Boas-Vindas (Visível por padrão) -->
            <section id="welcome-view" class="view">
                <h1 class="section-header">Bem-vindo(a) ao seu Dashboard!</h1>
                <p class="section-subheader">Selecione uma liga no menu lateral para registrar jogos ou clique em "Análise de Time" para pesquisar.</p>
                <div class="card">
                    <div class="card-header">
                        <i data-lucide="info" class="w-6 h-6 text-blue-600"></i>
                        <h2 class="card-title">Como Funciona</h2>
                    </div>
                    <div class="card-content text-gray-700 space-y-3">
                        <p><strong>1. Selecione uma Liga:</strong> Clique em uma das ligas no menu lateral (ex: Premier League).</p>
                        <p><strong>2. Registre Jogos:</strong> Na página da liga, use o formulário para adicionar os resultados dos jogos, incluindo gols, escanteios e cartões.</p>
                        <p><strong>3. Analise as Médias:</strong> Abaixo do formulário, o card "Análise por Time" mostrará as médias (gols, escanteios, cartões) dos últimos 10 jogos de cada time.</p>
                        <p><strong>4. Veja o Histórico:</strong> Clique no nome de um time (na "Análise por Time") para ver uma lista detalhada de todos os jogos que você salvou para ele.</p>
                        <p><strong>5. Pesquise Globalmente:</strong> Use a aba "Análise de Time" no menu lateral para pesquisar o histórico completo de qualquer time em todas as ligas.</p>
                    </div>
                </div>
            </section>

            <!-- 2. Tela da Liga (Oculta por padrão) -->
            <section id="league-view" class="view hidden">
                
                <!-- Cabeçalho da Liga (ex: "Premier League") -->
                <h1 id="league-view-header" class="section-header"></h1>
                <p class="section-subheader">Registre um novo jogo ou analise as estatísticas dos times.</p>

                <!-- Formulário de Registro -->
                <div class="card mb-8">
                    <div class="card-header">
                        <i data-lucide="plus-circle" class="w-6 h-6 text-blue-600"></i>
                        <h2 class="card-title">Registrar Novo Jogo</h2>
                    </div>
                    <form id="game-form" class="card-content">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-5 mb-5">
                            <div>
                                <label for="game-date" class="form-label">Data do Jogo</label>
                                <input type="date" id="game-date" class="form-input" required>
                            </div>
                            <div>
                                <label for="home-team-select" class="form-label">Time da Casa</label>
                                <select id="home-team-select" class="form-select" required>
                                    <!-- Options carregadas por JS -->
                                </select>
                            </div>
                            <div>
                                <label for="away-team-select" class="form-label">Time Visitante</label>
                                <select id="away-team-select" class="form-select" required>
                                    <!-- Options carregadas por JS -->
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 md:grid-cols-6 gap-4 mb-6">
                            <div>
                                <label for="home-goals" class="form-label">Gols Casa</label>
                                <input type="number" id="home-goals" class="form-input" min="0" value="0" required>
                            </div>
                            <div>
                                <label for="away-goals" class="form-label">Gols Visitante</label>
                                <input type="number" id="away-goals" class="form-input" min="0" value="0" required>
                            </div>
                            <div>
                                <label for="home-corners" class="form-label">Escanteios Casa</label>
                                <input type="number" id="home-corners" class="form-input" min="0" value="0" required>
                            </div>
                            <div>
                                <label for="away-corners" class="form-label">Escanteios Visitante</label>
                                <input type="number" id="away-corners" class="form-input" min="0" value="0" required>
                            </div>
                            <div>
                                <label for="home-cards" class="form-label">Cartões Casa</label>
                                <input type="number" id="home-cards" class="form-input" min="0" value="0" required>
                            </div>
                            <div>
                                <label for="away-cards" class="form-label">Cartões Visitante</label>
                                <input type="number" id="away-cards" class="form-input" min="0" value="0" required>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary w-full md:w-auto">
                            <i data-lucide="save" class="inline-block w-4 h-4 mr-1"></i>
                            Salvar Jogo
                        </button>
                    </form>
                </div>

                <!-- Jogos Salvos (Estilo "Resultados") -->
                <div class="card mb-8">
                    <div class="card-header">
                        <i data-lucide="list" class="w-6 h-6 text-blue-600"></i>
                        <h2 class="card-title">Jogos Salvos (Últimos 10)</h2>
                    </div>
                    <div class="card-content">
                        <div id="game-list-container" class="game-list">
                            <!-- Lista de jogos é injetada aqui -->
                        </div>
                        <p id="no-games-message" class="text-gray-500 text-center py-4">Nenhum jogo registrado para esta liga ainda.</p>
                    </div>
                </div>

                <!-- Análise por Time (Quadrados) -->
                <div class="card">
                    <div class="card-header">
                        <i data-lucide="bar-chart-2" class="w-6 h-6 text-blue-600"></i>
                        <h2 class="card-title">Análise por Time (Médias dos Últimos 10 Jogos)</h2>
                    </div>
                    <div class="card-content">
                        <div id="team-analysis-grid" class="analysis-grid">
                            <!-- Quadrados de análise são injetados aqui -->
                        </div>
                    </div>
                </div>

            </section>

            <!-- 3. Tela de Detalhe do Time (Oculta por padrão) -->
            <section id="team-detail-view" class="view hidden">
                <div class="flex items-center gap-4 mb-6">
                    <button id="detail-back-button" class="btn btn-secondary">
                        <i data-lucide="arrow-left" class="w-5 h-5"></i>
                    </button>
                    <div>
                        <h1 id="team-detail-header" class="section-header mb-0"></h1>
                        <p id="team-detail-subheader" class="section-subheader mb-0"></p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <i data-lucide="history" class="w-6 h-6 text-blue-600"></i>
                        <h2 class="card-title">Histórico de Jogos Salvos</h2>
                    </div>
                    <div class="card-content">
                        <div id="team-detail-list" class="space-y-2">
                            <!-- Lista de jogos do time é injetada aqui -->
                        </div>
                        <p id="no-team-games-message" class="text-gray-500 text-center py-4">Nenhum jogo encontrado para este time.</p>
                    </div>
                </div>
            </section>
            
            <!-- 4. Tela de Análise Global de Time (Oculta por padrão) -->
            <section id="global-analysis-view" class="view hidden">
                <h1 class="section-header">Análise Global de Time</h1>
                <p class="section-subheader">Pesquise o histórico completo de qualquer time registrado em seu banco de dados.</p>

                <!-- Formulário de Seleção -->
                <div class="card mb-8">
                    <div class="card-header">
                        <i data-lucide="search" class="w-6 h-6 text-blue-600"></i>
                        <h2 class="card-title">Buscar Time</h2>
                    </div>
                    <div class="card-content">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div>
                                <label for="global-league-select" class="form-label">1. Escolha a Liga</label>
                                <select id="global-league-select" class="form-select">
                                    <option value="">Selecione uma liga...</option>
                                    <!-- Opções carregadas por JS -->
                                </select>
                            </div>
                            <div>
                                <label for="global-team-select" class="form-label">2. Escolha o Time</label>
                                <select id="global-team-select" class="form-select" disabled>
                                    <option value="">Selecione um time...</option>
                                    <!-- Opções carregadas por JS -->
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabela de Resultados da Busca -->
                <div id="global-results-card" class="card hidden">
                    <div class="card-header">
                        <i data-lucide="history" class="w-6 h-6 text-blue-600"></i>
                        <h2 id="global-results-title" class="card-title">Histórico de Jogos</h2>
                    </div>
                    <div class="card-content overflow-x-auto">
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Adversário</th>
                                    <th>Gols (Pró x Contra)</th>
                                    <th>Escanteios (Pró x Contra)</th>
                                    <th>Cartões (Pró x Contra)</th>
                                </tr>
                            </thead>
                            <tbody id="global-results-table-body">
                                <!-- Dados da tabela são injetados aqui -->
                            </tbody>
                        </table>
                        <p id="global-no-results-message" class="text-gray-500 text-center py-6 hidden">Nenhum jogo salvo encontrado para este time.</p>
                    </div>
                </div>
            </section>

        </main>

    </div>

    <script>
        // --- Substitui os ícones do Lucide ---
        lucide.createIcons();

        // --- Dados dos Times (Temporada 2024/2025) ---
        const leagueTeams = {
            "Premier League": ["Arsenal", "Aston Villa", "Bournemouth", "Brentford", "Brighton", "Chelsea", "Crystal Palace", "Everton", "Fulham", "Ipswich Town", "Leicester City", "Liverpool", "Man City", "Man Utd", "Newcastle", "Nottingham Forest", "Southampton", "Tottenham", "West Ham", "Wolves"],
            "LaLiga": ["Alavés", "Athletic Bilbao", "Atlético Madrid", "Barcelona", "Celta Vigo", "Espanyol", "Getafe", "Girona", "Las Palmas", "Leganés", "Mallorca", "Osasuna", "Rayo Vallecano", "Real Betis", "Real Madrid", "Real Sociedad", "Sevilla", "Valencia", "Valladolid", "Villarreal"],
            "Bundesliga": ["Augsburg", "Bayer Leverkusen", "Bayern Munich", "Bochum", "Borussia Dortmund", "Borussia M'gladbach", "Eintracht Frankfurt", "Freiburg", "Heidenheim", "Holstein Kiel", "Hoffenheim", "Mainz", "RB Leipzig", "St. Pauli", "Stuttgart", "Union Berlin", "Werder Bremen", "Wolfsburg"],
            "Serie A": ["Atalanta", "Bologna", "Cagliari", "Como", "Empoli", "Fiorentina", "Genoa", "Hellas Verona", "Inter Milan", "Juventus", "Lazio", "Lecce", "AC Milan", "Monza", "Napoli", "Parma", "Roma", "Torino", "Udinese", "Venezia"],
            "Ligue 1": ["Angers", "Auxerre", "Brest", "Le Havre", "Lens", "Lille", "Lyon", "Marseille", "Monaco", "Montpellier", "Nantes", "Nice", "PSG", "Reims", "Rennes", "Saint-Étienne", "Strasbourg", "Toulouse"],
            "Liga Portugal": ["Arouca", "AVS", "Benfica", "Boavista", "Braga", "Casa Pia", "Estrela Amadora", "Famalicon", "Farense", "Gil Vicente", "Moreirense", "Nacional", "Porto", "Rio Ave", "Santa Clara", "Sporting CP", "Vitória de Guimarães", "Vizela"]
        };

        // --- Configuração Global ---
        const localStorageKey = 'meusJogosDB_v2'; // v2 inclui cartões
        let allGames = [];
        let currentLeague = null;

        // --- Seletores de Elementos ---
        const views = {
            welcome: document.getElementById('welcome-view'),
            league: document.getElementById('league-view'),
            teamDetail: document.getElementById('team-detail-view'),
            globalAnalysis: document.getElementById('global-analysis-view')
        };
        const navLinks = {
            welcome: document.getElementById('welcome-link'),
            analysis: document.getElementById('analysis-link'),
            leagues: document.querySelectorAll('.sidebar-link')
        };
        const leagueViewHeader = document.getElementById('league-view-header');
        const gameForm = document.getElementById('game-form');
        const homeTeamSelect = document.getElementById('home-team-select');
        const awayTeamSelect = document.getElementById('away-team-select');
        const gameDateInput = document.getElementById('game-date');
        const gameListContainer = document.getElementById('game-list-container');
        const noGamesMessage = document.getElementById('no-games-message');
        const teamAnalysisGrid = document.getElementById('team-analysis-grid');
        const detailBackButton = document.getElementById('detail-back-button');
        const teamDetailHeader = document.getElementById('team-detail-header');
        const teamDetailSubheader = document.getElementById('team-detail-subheader');
        const teamDetailList = document.getElementById('team-detail-list');
        const noTeamGamesMessage = document.getElementById('no-team-games-message');
        
        // Seletores da Análise Global
        const globalLeagueSelect = document.getElementById('global-league-select');
        const globalTeamSelect = document.getElementById('global-team-select');
        const globalResultsCard = document.getElementById('global-results-card');
        const globalResultsTitle = document.getElementById('global-results-title');
        const globalResultsTableBody = document.getElementById('global-results-table-body');
        const globalNoResultsMessage = document.getElementById('global-no-results-message');

        // --- Funções de Navegação ---

        function showView(viewId) {
            // Esconde todas as telas
            Object.values(views).forEach(view => view.classList.add('hidden'));
            // Mostra a tela solicitada
            if (views[viewId]) {
                views[viewId].classList.remove('hidden');
            }
            
            // Atualiza o estado ativo dos links do menu
            document.querySelectorAll('.sidebar-welcome-link, .sidebar-link').forEach(link => {
                link.classList.remove('active');
            });
            
            if (viewId === 'welcome') {
                navLinks.welcome.classList.add('active');
            } else if (viewId === 'globalAnalysis') {
                navLinks.analysis.classList.add('active');
            } else if (viewId === 'league' && currentLeague) {
                document.querySelector(`.sidebar-link[data-league="${currentLeague}"]`).classList.add('active');
            }
            
            // Substitui ícones do Lucide na nova tela
            lucide.createIcons();
        }

        function openLeagueView(leagueName) {
            currentLeague = leagueName;
            leagueViewHeader.textContent = leagueName;
            
            // Preenche os selects de time
            populateTeamSelects(leagueName, homeTeamSelect);
            populateTeamSelects(leagueName, awayTeamSelect);
            
            // Define a data padrão do jogo para hoje
            gameDateInput.value = new Date().toISOString().split('T')[0];
            
            // Atualiza o conteúdo da tela da liga
            updateLeagueContent();
            
            // Mostra a tela da liga
            showView('league');
        }

        function openTeamDetailView(teamName, leagueName) {
            teamDetailHeader.textContent = teamName;
            teamDetailSubheader.textContent = `Histórico de jogos em ${leagueName}`;
            
            const teamGames = getGamesForTeam(teamName).reverse(); // Mais recentes primeiro
            
            teamDetailList.innerHTML = ''; // Limpa a lista
            
            if (teamGames.length === 0) {
                noTeamGamesMessage.classList.remove('hidden');
            } else {
                noTeamGamesMessage.classList.add('hidden');
                
                teamGames.forEach((game, index) => {
                    const isHome = game.homeTeam === teamName;
                    const adversary = isHome ? game.awayTeam : game.homeTeam;
                    
                    const goalsPro = isHome ? game.homeGoals : game.awayGoals;
                    const goalsCon = isHome ? game.awayGoals : game.homeGoals;
                    const cornersPro = isHome ? game.homeCorners : game.awayCorners;
                    const cornersCon = isHome ? game.awayCorners : game.homeCorners;
                    const cardsPro = isHome ? game.homeCards : game.awayCards;
                    const cardsCon = isHome ? game.awayCards : game.homeCards;

                    const cardHtml = `
                        <div class="game-card">
                            <span class="game-date">${new Date(game.date).toLocaleDateString('pt-BR', {day: '2-digit', month: '2-digit'})}</span>
                            <div class="game-teams">
                                <span class="font-medium">${index + 1}. vs ${adversary}</span>
                            </div>
                            <div class="score-line gap-2 md:gap-4">
                                <span class="score-stats" title="Gols (Pró x Contra)">
                                    <i data-lucide="shield" class="w-4 h-4 inline-block"></i> ${goalsPro} x ${goalsCon}
                                </span>
                                <span class="score-stats" title="Escanteios (Pró x Contra)">
                                    <i data-lucide="flag" class="w-4 h-4 inline-block"></i> ${cornersPro} x ${cornersCon}
                                </span>
                                <span class="score-stats" title="Cartões (Pró x Contra)">
                                    <i data-lucide="rectangle-vertical" class="w-4 h-4 inline-block"></i> ${cardsPro} x ${cardsCon}
                                </span>
                            </div>
                        </div>
                    `;
                    teamDetailList.innerHTML += cardHtml;
                });
            }
            
            showView('teamDetail');
        }
        
        function openGlobalAnalysisView() {
            showView('globalAnalysis');
            
            // Popula o select de ligas global
            globalLeagueSelect.innerHTML = '<option value="">Selecione uma liga...</option>';
            Object.keys(leagueTeams).sort().forEach(league => {
                globalLeagueSelect.innerHTML += `<option value="${league}">${league}</option>`;
            });
            
            // Reseta o select de times e a tabela
            globalTeamSelect.innerHTML = '<option value="">Selecione um time...</option>';
            globalTeamSelect.disabled = true;
            globalResultsCard.classList.add('hidden');
        }

        // --- Lógica do Banco de Dados (localStorage) ---

        function loadAllGames() {
            allGames = JSON.parse(localStorage.getItem(localStorageKey)) || [];
            // Converte strings de números para números (para dados antigos)
            allGames = allGames.map(game => ({
                ...game,
                homeGoals: parseInt(game.homeGoals || 0),
                awayGoals: parseInt(game.awayGoals || 0),
                homeCorners: parseInt(game.homeCorners || 0),
                awayCorners: parseInt(game.awayCorners || 0),
                homeCards: parseInt(game.homeCards || 0), // Novo campo
                awayCards: parseInt(game.awayCards || 0)  // Novo campo
            }));
        }

        function saveAllGames() {
            localStorage.setItem(localStorageKey, JSON.stringify(allGames));
        }

        function addGame(game) {
            allGames.push(game);
            saveAllGames();
        }

        function deleteGame(gameId) {
            allGames = allGames.filter(game => game.id !== gameId);
            saveAllGames();
            
            // Atualiza a tela da liga (se estiver nela)
            if (!views.league.classList.contains('hidden')) {
                updateLeagueContent();
            }
            // Atualiza a tela de análise global (se estiver nela)
            if (!views.globalAnalysis.classList.contains('hidden')) {
                updateGlobalAnalysisTable();
            }
        }

        function getGamesForLeague(leagueName) {
            return allGames.filter(game => game.league === leagueName);
        }

        function getGamesForTeam(teamName) {
            return allGames.filter(game => game.homeTeam === teamName || game.awayTeam === teamName);
        }

        // --- Lógica da Tela da Liga ---

        function populateTeamSelects(leagueName, selectElement) {
            const teams = leagueTeams[leagueName] || [];
            selectElement.innerHTML = ''; // Limpa opções anteriores
            teams.sort().forEach(team => {
                selectElement.innerHTML += `<option value="${team}">${team}</option>`;
            });
        }

        function handleGameFormSubmit(e) {
            e.preventDefault();
            
            // Coleta os dados do formulário
            const newGame = {
                id: Date.now().toString(), // ID único
                date: gameDateInput.value,
                league: currentLeague,
                homeTeam: homeTeamSelect.value,
                awayTeam: awayTeamSelect.value,
                homeGoals: parseInt(document.getElementById('home-goals').value),
                awayGoals: parseInt(document.getElementById('away-goals').value),
                homeCorners: parseInt(document.getElementById('home-corners').value),
                awayCorners: parseInt(document.getElementById('away-corners').value),
                homeCards: parseInt(document.getElementById('home-cards').value),
                awayCards: parseInt(document.getElementById('away-cards').value)
            };

            // Validação simples
            if (newGame.homeTeam === newGame.awayTeam) {
                alert('O time da casa e o visitante não podem ser o mesmo.');
                return;
            }

            // Adiciona o jogo e salva
            addGame(newGame);
            
            // Limpa o formulário (exceto data e times)
            gameForm.reset();
            // Restaura os selects para os padrões
            populateTeamSelects(currentLeague, homeTeamSelect);
            populateTeamSelects(currentLeague, awayTeamSelect);
            // Mantém a data de hoje
            gameDateInput.value = new Date().toISOString().split('T')[0];

            // Atualiza a lista de jogos e a análise
            updateLeagueContent();
        }

        function updateLeagueContent() {
            // Atualiza a lista de jogos salvos
            renderGameList(currentLeague);
            // Atualiza os quadrados de análise
            renderTeamAnalysis(currentLeague);
        }

        function renderGameList(leagueName) {
            const leagueGames = getGamesForLeague(leagueName).sort((a, b) => new Date(b.date) - new Date(a.date)); // Mais recentes primeiro
            const recentGames = leagueGames.slice(0, 10); // Pega só os 10 últimos
            
            gameListContainer.innerHTML = ''; // Limpa a lista

            if (recentGames.length === 0) {
                noGamesMessage.classList.remove('hidden');
            } else {
                noGamesMessage.classList.add('hidden');
                recentGames.forEach(game => {
                    const gameCard = `
                        <div class="game-card">
                            <span class="game-date">${new Date(game.date).toLocaleDateString('pt-BR', {day: '2-digit', month: '2-digit'})}</span>
                            
                            <div class="game-teams">
                                <div class="score-line">
                                    <span class="team-name home">${game.homeTeam}</span>
                                    <span class="score-box">${game.homeGoals} - ${game.awayGoals}</span>
                                    <span class="team-name away">${game.awayTeam}</span>
                                </div>
                                <div class="score-line mt-1">
                                    <span class="score-stats" title="Escanteios">Esc: ${game.homeCorners} x ${game.awayCorners}</span>
                                    <span class="score-stats" title="Cartões">Car: ${game.homeCards} x ${game.awayCards}</span>
                                </div>
                            </div>
                            
                            <div class="game-delete">
                                <button class="delete-btn" title="Excluir Jogo" onclick="deleteGame('${game.id}')">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    gameListContainer.innerHTML += gameCard;
                });
                // Recria os ícones do Lucide
                lucide.createIcons();
            }
        }

        function renderTeamAnalysis(leagueName) {
            const teams = leagueTeams[leagueName] || [];
            teamAnalysisGrid.innerHTML = ''; // Limpa o grid

            teams.sort().forEach(teamName => {
                // Pega os últimos 10 jogos do time
                const teamGames = getGamesForTeam(teamName)
                                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                                    .slice(0, 10);
                
                const stats = {
                    games: teamGames.length,
                    goalsPro: 0,
                    goalsCon: 0,
                    cornersPro: 0,
                    cornersCon: 0,
                    cardsPro: 0,
                    cardsCon: 0
                };

                if (stats.games > 0) {
                    teamGames.forEach(game => {
                        if (game.homeTeam === teamName) {
                            stats.goalsPro += game.homeGoals;
                            stats.goalsCon += game.awayGoals;
                            stats.cornersPro += game.homeCorners;
                            stats.cornersCon += game.awayCorners;
                            stats.cardsPro += game.homeCards;
                            stats.cardsCon += game.awayCards;
                        } else {
                            stats.goalsPro += game.awayGoals;
                            stats.goalsCon += game.homeGoals;
                            stats.cornersPro += game.awayCorners;
                            stats.cornersCon += game.homeCorners;
                            stats.cardsPro += game.awayCards;
                            stats.cardsCon += game.homeCards;
                        }
                    });
                }
                
                // Calcula as médias
                const avgGoalsPro = stats.games > 0 ? (stats.goalsPro / stats.games).toFixed(1) : '0.0';
                const avgGoalsCon = stats.games > 0 ? (stats.goalsCon / stats.games).toFixed(1) : '0.0';
                const avgCornersPro = stats.games > 0 ? (stats.cornersPro / stats.games).toFixed(1) : '0.0';
                const avgCornersCon = stats.games > 0 ? (stats.cornersCon / stats.games).toFixed(1) : '0.0';
                const avgCardsPro = stats.games > 0 ? (stats.cardsPro / stats.games).toFixed(1) : '0.0';
                const avgCardsCon = stats.games > 0 ? (stats.cardsCon / stats.games).toFixed(1) : '0.0';

                const cardHtml = `
                    <div class="team-analysis-card">
                        <div class="team-card-header">
                            <h3 class="team-card-title" data-team="${teamName}" data-league="${leagueName}">${teamName}</h3>
                            <span class="text-xs font-bold text-gray-500">${stats.games} JOGOS</span>
                        </div>
                        <div class="team-card-stats">
                            <div class="stat-line">
                                <span class="stat-label">Média Gols (Pró/Contra)</span>
                                <div>
                                    <span class="stat-value pro">${avgGoalsPro}</span> /
                                    <span class="stat-value con">${avgGoalsCon}</span>
                                </div>
                            </div>
                            <div class="stat-line">
                                <span class="stat-label">Média Escanteios (Pró/Contra)</span>
                                <div>
                                    <span class="stat-value pro">${avgCornersPro}</span> /
                                    <span class="stat-value con">${avgCornersCon}</span>
                                </div>
                            </div>
                            <div class="stat-line">
                                <span class="stat-label">Média Cartões (Pró/Contra)</span>
                                <div>
                                    <span class="stat-value pro">${avgCardsPro}</span> /
                                    <span class="stat-value con">${avgCardsCon}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                teamAnalysisGrid.innerHTML += cardHtml;
            });
            
            // Adiciona listener de clique para os títulos dos times (para abrir o detalhe)
            document.querySelectorAll('.team-card-title').forEach(title => {
                title.addEventListener('click', (e) => {
                    const teamName = e.target.dataset.team;
                    const leagueName = e.target.dataset.league;
                    openTeamDetailView(teamName, leagueName);
                });
            });
        }
        
        // --- Lógica da Tela de Análise Global ---

        function updateGlobalAnalysisTable() {
            const selectedTeam = globalTeamSelect.value;
            
            if (!selectedTeam) {
                globalResultsCard.classList.add('hidden');
                return;
            }
            
            globalResultsTitle.textContent = `Histórico de Jogos: ${selectedTeam}`;
            globalResultsCard.classList.remove('hidden');
            
            const teamGames = getGamesForTeam(selectedTeam).sort((a, b) => new Date(b.date) - new Date(a.date)); // Mais recentes primeiro
            
            globalResultsTableBody.innerHTML = '';
            
            if (teamGames.length === 0) {
                globalNoResultsMessage.classList.remove('hidden');
            } else {
                globalNoResultsMessage.classList.add('hidden');
                teamGames.forEach(game => {
                    const isHome = game.homeTeam === selectedTeam;
                    const adversary = isHome ? game.awayTeam : game.homeTeam;
                    
                    const goalsPro = isHome ? game.homeGoals : game.awayGoals;
                    const goalsCon = isHome ? game.awayGoals : game.homeGoals;
                    const cornersPro = isHome ? game.homeCorners : game.awayCorners;
                    const cornersCon = isHome ? game.awayCorners : game.homeCorners;
                    const cardsPro = isHome ? game.homeCards : game.awayCards;
                    const cardsCon = isHome ? game.awayCards : game.homeCards;

                    const rowHtml = `
                        <tr>
                            <td>${new Date(game.date).toLocaleDateString('pt-BR')}</td>
                            <td>${isHome ? '(Casa)' : '(Fora)'} vs ${adversary}</td>
                            <td>${goalsPro} x ${goalsCon}</td>
                            <td>${cornersPro} x ${cornersCon}</td>
                            <td>${cardsPro} x ${cardsCon}</td>
                        </tr>
                    `;
                    globalResultsTableBody.innerHTML += rowHtml;
                });
            }
            lucide.createIcons(); // Para ícones futuros na tabela, se houver
        }

        // --- Event Listeners (Inicialização) ---
        document.addEventListener('DOMContentLoaded', () => {
            loadAllGames();
            
            // Navegação: Links do Menu Lateral
            navLinks.leagues.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const leagueName = e.currentTarget.dataset.league;
                    openLeagueView(leagueName);
                });
            });
            
            // Navegação: Link de Boas-Vindas
            navLinks.welcome.addEventListener('click', (e) => {
                e.preventDefault();
                showView('welcome');
            });
            
            // Navegação: Link de Análise Global
            navLinks.analysis.addEventListener('click', (e) => {
                e.preventDefault();
                openGlobalAnalysisView();
            });

            // Navegação: Botão Voltar (do Detalhe do Time)
            detailBackButton.addEventListener('click', (e) => {
                e.preventDefault();
                openLeagueView(currentLeague); // Volta para a tela da liga atual
            });
            
            // Ação: Submit do Formulário de Jogo
            gameForm.addEventListener('submit', handleGameFormSubmit);
            
            // Ações: Seletores da Análise Global
            globalLeagueSelect.addEventListener('change', () => {
                const leagueName = globalLeagueSelect.value;
                globalTeamSelect.disabled = true;
                globalResultsCard.classList.add('hidden');
                globalTeamSelect.innerHTML = '<option value="">Selecione um time...</option>';
                
                if (leagueName) {
                    const teams = leagueTeams[leagueName] || [];
                    teams.sort().forEach(team => {
                        globalTeamSelect.innerHTML += `<option value="${team}">${team}</option>`;
                    });
                    globalTeamSelect.disabled = false;
                }
            });
            
            globalTeamSelect.addEventListener('change', updateGlobalAnalysisTable);

            // Inicia na tela de boas-vindas
            showView('welcome');
        });

    </script>
</body>
</html>